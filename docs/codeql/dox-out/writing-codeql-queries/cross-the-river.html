
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cross the river &#8212; CodeQL</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="CodeQL language guides" href="../codeql-language-guides/index.html" />
    <link rel="prev" title="Crown the rightful heir" href="crown-the-rightful-heir.html" />

<title>CodeQL docs</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="../_static/custom.css" type="text/css" />
<link rel="stylesheet" href="../_static/primer.css" type="text/css" />


  </head><body>
<header class="Header">
    <div class="Header-item--full">
        <a href="https://codeql.github.com/docs" class="Header-link f2 d-flex flex-items-center">
            <!-- <%= octicon "mark-github", class: "mr-2", height: 32 %> -->
            <svg height="32" class="octicon octicon-mark-github mr-2" viewBox="0 0 16 16" version="1.1" width="32"
                aria-hidden="true">
                <path fill-rule="evenodd"
                    d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z">
                </path>
            </svg>
            <span class="hide-sm">CodeQL documentation</span>
        </a>
    </div>
    <div class="Header-item hide-sm hide-md">
        <script src="https://addsearch.com/js/?key=93b4d287e2fc079a4089412b669785d5&categories=!0xhelp.semmle.com,0xcodeql.github.com,1xdocs,1xcodeql-standard-libraries,1xcodeql-query-help"></script>
    </div>
    <div class="Header-item">

        <details class="dropdown details-reset details-overlay d-inline-block">
            <summary class="btn bg-gray-dark text-white border" aria-haspopup="true">
                CodeQL resources
                <div class="dropdown-caret"></div>
            </summary>

            <ul class="dropdown-menu dropdown-menu-se dropdown-menu-dark">
                <li><a class="dropdown-item" href="https://codeql.github.com/docs/codeql-overview">CodeQL overview</a></li>
                <li class="dropdown-divider" role="separator"></li>
                <div class="dropdown-header">
                    CodeQL tools
                </div>
                <li><a class="dropdown-item" href="https://codeql.github.com/docs/codeql-for-visual-studio-code">CodeQL for VS Code</a>
                <li><a class="dropdown-item" href="https://codeql.github.com/docs/codeql-cli">CodeQL CLI</a>
                </li>
                <li class="dropdown-divider" role="separator"></li>
                <div class="dropdown-header">
                    CodeQL guides
                </div>
                <li><a class="dropdown-item" href="https://codeql.github.com/docs/writing-codeql-queries">Writing CodeQL queries</a></li>
                <li><a class="dropdown-item" href="https://codeql.github.com/docs/codeql-language-guides">CodeQL language guides</a>
                <li class="dropdown-divider" role="separator"></li>
                <div class="dropdown-header">
                    Reference docs
                </div>
                <li><a class="dropdown-item" href="https://codeql.github.com/docs/ql-language-reference/">QL language
                        reference</a>
                <li><a class="dropdown-item" href="https://codeql.github.com/codeql-standard-libraries">CodeQL
                        standard-libraries</a>
                <li><a class="dropdown-item" href="https://codeql.github.com/codeql-query-help">CodeQL
                        query help</a>
                <li class="dropdown-divider" role="separator"></li>
                <div class="dropdown-header">
                    Source files
                </div>
                <li><a class="dropdown-item" href="https://github.com/github/codeql">CodeQL repository</a>
            </ul>
        </details>

    </div>

</header>
<main class="bg-gray-light clearfix">
<nav class="SideNav position-sticky top-0 col-lg-3 col-md-3 float-left p-4 hide-sm hide-md overflow-y-auto">

    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../codeql-overview/index.html">CodeQL overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../codeql-for-visual-studio-code/index.html">CodeQL for Visual Studio Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../codeql-cli/index.html">CodeQL CLI</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Writing CodeQL queries</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="codeql-queries.html">CodeQL queries</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="ql-tutorials.html">QL tutorials</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="introduction-to-ql.html">Introduction to QL</a></li>
<li class="toctree-l3"><a class="reference internal" href="find-the-thief.html">Find the thief</a></li>
<li class="toctree-l3"><a class="reference internal" href="catch-the-fire-starter.html">Catch the fire starter</a></li>
<li class="toctree-l3"><a class="reference internal" href="crown-the-rightful-heir.html">Crown the rightful heir</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Cross the river</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../codeql-language-guides/index.html">CodeQL language guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ql-language-reference/index.html">QL language reference</a></li>
</ul>


</nav>


<div class="body col-sm-12 col-md-9 col-lg-9 float-left border-left">

    <div class="hide-lg hide-xl px-4 pt-4">
        
<div class="related" role="navigation" aria-label="related navigation">
    <ul>
        <li class="nav-item nav-item-0"><a href="../contents.html">CodeQL</a> &#187;</li>
        <li class="nav-item nav-item-1"><a href="index.html"
                >Writing CodeQL queries</a> &#187;</li>
        <li class="nav-item nav-item-2"><a href="ql-tutorials.html"
                accesskey="U">QL tutorials</a> &#187;</li> 
    </ul>
</div>
    </div>

    <article class="p-4 col-lg-10 col-md-10 col-sm-12">
        
  <div class="section" id="cross-the-river-1">
<span id="cross-the-river"></span><h1>Cross the river<a class="headerlink" href="#cross-the-river-1" title="Permalink to this headline">¶</a></h1>
<p>Use common QL features to write a query that finds a solution to the “River crossing” logic puzzle.</p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<blockquote class="pull-quote">
<div><p>River crossing puzzle</p>
<p>A man is trying to ferry a goat, a cabbage, and a wolf across a river.
His boat can only take himself and at most one item as cargo.
His problem is that if the goat is left alone with the cabbage, it will eat it.
And if the wolf is left alone with the goat, it will eat it.
How does he get everything across the river?</p>
</div></blockquote>
<p>A solution should be a set of instructions for how to ferry the items, such as “First ferry the goat
across the river, and come back with nothing. Then ferry the cabbage across, and come back with …”</p>
<p>There are lots of ways to approach this problem and implement it in QL. Before you start, make
sure that you are familiar with how to define <a class="reference internal" href="../ql-language-reference/types.html#classes"><span class="std std-ref">classes</span></a>
and <a class="reference internal" href="../ql-language-reference/predicates.html#predicates"><span class="std std-ref">predicates</span></a> in QL.
The following walkthrough is just one of many possible implementations, so have a go at writing your
own query too! To find more example queries, see the list <a class="reference internal" href="#alternatives"><span class="std std-ref">below</span></a>.</p>
</div>
<div class="section" id="walkthrough">
<h2>Walkthrough<a class="headerlink" href="#walkthrough" title="Permalink to this headline">¶</a></h2>
<div class="section" id="model-the-elements-of-the-puzzle">
<h3>Model the elements of the puzzle<a class="headerlink" href="#model-the-elements-of-the-puzzle" title="Permalink to this headline">¶</a></h3>
<p>The basic components of the puzzle are the cargo items and the shores on either side of the river.
Start by modeling these as classes.</p>
<p>First, define a class <code class="docutils literal notranslate"><span class="pre">Cargo</span></code> containing the different cargo items.
Note that the man can also travel on his own, so it helps to explicitly include <code class="docutils literal notranslate"><span class="pre">&quot;Nothing&quot;</span></code> as
a piece of cargo.</p>
<div class="toggle docutils container">
<div class="name docutils container">
<em>Show/hide code</em></div>
<div class="highlight-ql notranslate"><div class="highlight"><pre><span></span><span class="cp">/** A possible cargo item. */</span>
<span class="k">class</span> <span class="n">Cargo</span> <span class="k">extends</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="n">Cargo</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span> <span class="o">=</span> <span class="s">&quot;Nothing&quot;</span> <span class="k">or</span>
    <span class="k">this</span> <span class="o">=</span> <span class="s">&quot;Goat&quot;</span> <span class="k">or</span>
    <span class="k">this</span> <span class="o">=</span> <span class="s">&quot;Cabbage&quot;</span> <span class="k">or</span>
    <span class="k">this</span> <span class="o">=</span> <span class="s">&quot;Wolf&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Second, any item can be on one of two shores. Let’s call these the “left shore” and the “right shore”.
Define a class <code class="docutils literal notranslate"><span class="pre">Shore</span></code> containing <code class="docutils literal notranslate"><span class="pre">&quot;Left&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;Right&quot;</span></code>.</p>
<p>It would be helpful to express “the other shore” to model moving from one side of the river to the other.
You can do this by defining a member predicate
<code class="docutils literal notranslate"><span class="pre">other</span></code> in the class <code class="docutils literal notranslate"><span class="pre">Shore</span></code> such that <code class="docutils literal notranslate"><span class="pre">&quot;Left&quot;.other()</span></code> returns <code class="docutils literal notranslate"><span class="pre">&quot;Right&quot;</span></code> and vice versa.</p>
<div class="toggle docutils container">
<div class="name docutils container">
<em>Show/hide code</em></div>
<div class="highlight-ql notranslate"><div class="highlight"><pre><span></span><span class="cp">/** One of two shores. */</span>
<span class="k">class</span> <span class="n">Shore</span> <span class="k">extends</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="n">Shore</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span> <span class="o">=</span> <span class="s">&quot;Left&quot;</span> <span class="k">or</span>
    <span class="k">this</span> <span class="o">=</span> <span class="s">&quot;Right&quot;</span>
  <span class="p">}</span>

  <span class="cp">/** Returns the other shore. */</span>
  <span class="n">Shore</span> <span class="n">other</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span> <span class="o">=</span> <span class="s">&quot;Left&quot;</span> <span class="k">and</span> <span class="k">result</span> <span class="o">=</span> <span class="s">&quot;Right&quot;</span>
    <span class="k">or</span>
    <span class="k">this</span> <span class="o">=</span> <span class="s">&quot;Right&quot;</span> <span class="k">and</span> <span class="k">result</span> <span class="o">=</span> <span class="s">&quot;Left&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>We also want a way to keep track of where the man, the goat, the cabbage, and the wolf are at any point. We can call this combined
information the “state”. Define a class <code class="docutils literal notranslate"><span class="pre">State</span></code> that encodes the location of each piece of cargo.
For example, if the man is on the left shore, the goat on the right shore, and the cabbage and wolf on the left
shore, the state should be <code class="docutils literal notranslate"><span class="pre">Left,</span> <span class="pre">Right,</span> <span class="pre">Left,</span> <span class="pre">Left</span></code>.</p>
<p>You may find it helpful to introduce some variables that refer to the shore on which the man and the cargo items are. These
temporary variables in the body of a class are called <a class="reference internal" href="../ql-language-reference/types.html#fields"><span class="std std-ref">fields</span></a>.</p>
<div class="toggle docutils container">
<div class="name docutils container">
<em>Show/hide code</em></div>
<div class="highlight-ql notranslate"><div class="highlight"><pre><span></span><span class="cp">/** A record of where everything is. */</span>
<span class="k">class</span> <span class="n">State</span> <span class="k">extends</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="n">Shore</span> <span class="n">manShore</span><span class="p">;</span>
  <span class="n">Shore</span> <span class="n">goatShore</span><span class="p">;</span>
  <span class="n">Shore</span> <span class="n">cabbageShore</span><span class="p">;</span>
  <span class="n">Shore</span> <span class="n">wolfShore</span><span class="p">;</span>

  <span class="n">State</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span> <span class="o">=</span> <span class="n">manShore</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">goatShore</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">cabbageShore</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">wolfShore</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>We are interested in two particular states, namely the initial state and the goal state,
which we have to achieve to solve the puzzle.
Assuming that all items start on the left shore and end up on the right shore, define
<code class="docutils literal notranslate"><span class="pre">InitialState</span></code> and <code class="docutils literal notranslate"><span class="pre">GoalState</span></code> as subclasses of <code class="docutils literal notranslate"><span class="pre">State</span></code>.</p>
<div class="toggle docutils container">
<div class="name docutils container">
<em>Show/hide code</em></div>
<div class="highlight-ql notranslate"><div class="highlight"><pre><span></span><span class="cp">/** The initial state, where everything is on the left shore. */</span>
<span class="k">class</span> <span class="n">InitialState</span> <span class="k">extends</span> <span class="n">State</span> <span class="p">{</span>
  <span class="n">InitialState</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span> <span class="o">=</span> <span class="s">&quot;Left&quot;</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="s">&quot;Left&quot;</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="s">&quot;Left&quot;</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="s">&quot;Left&quot;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="cp">/** The goal state, where everything is on the right shore. */</span>
<span class="k">class</span> <span class="n">GoalState</span> <span class="k">extends</span> <span class="n">State</span> <span class="p">{</span>
  <span class="n">GoalState</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span> <span class="o">=</span> <span class="s">&quot;Right&quot;</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="s">&quot;Right&quot;</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="s">&quot;Right&quot;</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="s">&quot;Right&quot;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<blockquote class="pull-quote">
<div><p>Note</p>
<p>To avoid typing out the lengthy string concatenations, you could introduce a helper predicate
<code class="docutils literal notranslate"><span class="pre">renderState</span></code> that renders the state in the required form.</p>
</div></blockquote>
<p>Using the above note, the QL code so far looks like this:</p>
<div class="toggle docutils container">
<div class="name docutils container">
<em>Show/hide code</em></div>
<div class="highlight-ql notranslate"><div class="highlight"><pre><span></span><span class="cp">/** A possible cargo item. */</span>
<span class="k">class</span> <span class="n">Cargo</span> <span class="k">extends</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="n">Cargo</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span> <span class="o">=</span> <span class="s">&quot;Nothing&quot;</span> <span class="k">or</span>
    <span class="k">this</span> <span class="o">=</span> <span class="s">&quot;Goat&quot;</span> <span class="k">or</span>
    <span class="k">this</span> <span class="o">=</span> <span class="s">&quot;Cabbage&quot;</span> <span class="k">or</span>
    <span class="k">this</span> <span class="o">=</span> <span class="s">&quot;Wolf&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cp">/** One of two shores. */</span>
<span class="k">class</span> <span class="n">Shore</span> <span class="k">extends</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="n">Shore</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span> <span class="o">=</span> <span class="s">&quot;Left&quot;</span> <span class="k">or</span>
    <span class="k">this</span> <span class="o">=</span> <span class="s">&quot;Right&quot;</span>
  <span class="p">}</span>

  <span class="cp">/** Returns the other shore. */</span>
  <span class="n">Shore</span> <span class="n">other</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span> <span class="o">=</span> <span class="s">&quot;Left&quot;</span> <span class="k">and</span> <span class="k">result</span> <span class="o">=</span> <span class="s">&quot;Right&quot;</span>
    <span class="k">or</span>
    <span class="k">this</span> <span class="o">=</span> <span class="s">&quot;Right&quot;</span> <span class="k">and</span> <span class="k">result</span> <span class="o">=</span> <span class="s">&quot;Left&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cp">/** Renders the state as a string. */</span>
<span class="kt">string</span> <span class="n">renderState</span><span class="p">(</span><span class="n">Shore</span> <span class="n">manShore</span><span class="p">,</span> <span class="n">Shore</span> <span class="n">goatShore</span><span class="p">,</span> <span class="n">Shore</span> <span class="n">cabbageShore</span><span class="p">,</span> <span class="n">Shore</span> <span class="n">wolfShore</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">result</span> <span class="o">=</span> <span class="n">manShore</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">goatShore</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">cabbageShore</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">wolfShore</span>
<span class="p">}</span>

<span class="cp">/** A record of where everything is. */</span>
<span class="k">class</span> <span class="n">State</span> <span class="k">extends</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="n">Shore</span> <span class="n">manShore</span><span class="p">;</span>
  <span class="n">Shore</span> <span class="n">goatShore</span><span class="p">;</span>
  <span class="n">Shore</span> <span class="n">cabbageShore</span><span class="p">;</span>
  <span class="n">Shore</span> <span class="n">wolfShore</span><span class="p">;</span>

  <span class="n">State</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span> <span class="o">=</span> <span class="n">renderState</span><span class="p">(</span><span class="n">manShore</span><span class="p">,</span> <span class="n">goatShore</span><span class="p">,</span> <span class="n">cabbageShore</span><span class="p">,</span> <span class="n">wolfShore</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>

<span class="cp">/** The initial state, where everything is on the left shore. */</span>
<span class="k">class</span> <span class="n">InitialState</span> <span class="k">extends</span> <span class="n">State</span> <span class="p">{</span>
  <span class="n">InitialState</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span> <span class="o">=</span> <span class="n">renderState</span><span class="p">(</span><span class="s">&quot;Left&quot;</span><span class="p">,</span> <span class="s">&quot;Left&quot;</span><span class="p">,</span> <span class="s">&quot;Left&quot;</span><span class="p">,</span> <span class="s">&quot;Left&quot;</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>

<span class="cp">/** The goal state, where everything is on the right shore. */</span>
<span class="k">class</span> <span class="n">GoalState</span> <span class="k">extends</span> <span class="n">State</span> <span class="p">{</span>
  <span class="n">GoalState</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span> <span class="o">=</span> <span class="n">renderState</span><span class="p">(</span><span class="s">&quot;Right&quot;</span><span class="p">,</span> <span class="s">&quot;Right&quot;</span><span class="p">,</span> <span class="s">&quot;Right&quot;</span><span class="p">,</span> <span class="s">&quot;Right&quot;</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="model-the-action-of-ferrying">
<h3>Model the action of “ferrying”<a class="headerlink" href="#model-the-action-of-ferrying" title="Permalink to this headline">¶</a></h3>
<p>The basic act of ferrying moves the man and one cargo item to the other shore,
resulting in a new state.</p>
<p>Write a member predicate (of <code class="docutils literal notranslate"><span class="pre">State</span></code>) called <code class="docutils literal notranslate"><span class="pre">ferry</span></code>, that specifies what happens to the state
after ferrying a particular cargo. (Hint: Use the predicate <code class="docutils literal notranslate"><span class="pre">other</span></code>.)</p>
<div class="toggle docutils container">
<div class="name docutils container">
<em>Show/hide code</em></div>
<div class="highlight-ql notranslate"><div class="highlight"><pre><span></span>  <span class="cp">/** Returns the state that is reached after ferrying a particular cargo item. */</span>
  <span class="n">State</span> <span class="n">ferry</span><span class="p">(</span><span class="n">Cargo</span> <span class="n">cargo</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cargo</span> <span class="o">=</span> <span class="s">&quot;Nothing&quot;</span> <span class="k">and</span>
    <span class="k">result</span> <span class="o">=</span> <span class="n">renderState</span><span class="p">(</span><span class="n">manShore</span><span class="p">.</span><span class="n">other</span><span class="p">(),</span> <span class="n">goatShore</span><span class="p">,</span> <span class="n">cabbageShore</span><span class="p">,</span> <span class="n">wolfShore</span><span class="p">)</span>
    <span class="k">or</span>
    <span class="n">cargo</span> <span class="o">=</span> <span class="s">&quot;Goat&quot;</span> <span class="k">and</span>
    <span class="k">result</span> <span class="o">=</span> <span class="n">renderState</span><span class="p">(</span><span class="n">manShore</span><span class="p">.</span><span class="n">other</span><span class="p">(),</span> <span class="n">goatShore</span><span class="p">.</span><span class="n">other</span><span class="p">(),</span> <span class="n">cabbageShore</span><span class="p">,</span> <span class="n">wolfShore</span><span class="p">)</span>
    <span class="k">or</span>
    <span class="n">cargo</span> <span class="o">=</span> <span class="s">&quot;Cabbage&quot;</span> <span class="k">and</span>
    <span class="k">result</span> <span class="o">=</span> <span class="n">renderState</span><span class="p">(</span><span class="n">manShore</span><span class="p">.</span><span class="n">other</span><span class="p">(),</span> <span class="n">goatShore</span><span class="p">,</span> <span class="n">cabbageShore</span><span class="p">.</span><span class="n">other</span><span class="p">(),</span> <span class="n">wolfShore</span><span class="p">)</span>
    <span class="k">or</span>
    <span class="n">cargo</span> <span class="o">=</span> <span class="s">&quot;Wolf&quot;</span> <span class="k">and</span>
    <span class="k">result</span> <span class="o">=</span> <span class="n">renderState</span><span class="p">(</span><span class="n">manShore</span><span class="p">.</span><span class="n">other</span><span class="p">(),</span> <span class="n">goatShore</span><span class="p">,</span> <span class="n">cabbageShore</span><span class="p">,</span> <span class="n">wolfShore</span><span class="p">.</span><span class="n">other</span><span class="p">())</span>
  <span class="p">}</span>
</pre></div>
</div>
</div>
<p>Of course, not all ferrying actions are possible. Add some extra conditions to describe when a ferrying
action is “safe”. That is, it doesn’t lead to a state where the goat or the cabbage get eaten.
For example, follow these steps:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Define a predicate <code class="docutils literal notranslate"><span class="pre">isSafe</span></code> that holds when the state itself is safe. Use this to encode the
conditions for when nothing gets eaten.</li>
<li>Define a predicate <code class="docutils literal notranslate"><span class="pre">safeFerry</span></code> that restricts <code class="docutils literal notranslate"><span class="pre">ferry</span></code> to only include safe ferrying actions.</li>
</ol>
</div></blockquote>
<div class="toggle docutils container">
<div class="name docutils container">
<em>Show/hide code</em></div>
<div class="highlight-ql notranslate"><div class="highlight"><pre><span></span>  <span class="cp">/**</span>
<span class="cp">   * Holds if the state is safe. This occurs when neither the goat nor the cabbage</span>
<span class="cp">   * can get eaten.</span>
<span class="cp">   */</span>
  <span class="k">predicate</span> <span class="n">isSafe</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// The goat can&#39;t eat the cabbage.</span>
    <span class="p">(</span><span class="n">goatShore</span> <span class="o">!=</span> <span class="n">cabbageShore</span> <span class="k">or</span> <span class="n">goatShore</span> <span class="o">=</span> <span class="n">manShore</span><span class="p">)</span> <span class="k">and</span>
    <span class="c1">// The wolf can&#39;t eat the goat.</span>
    <span class="p">(</span><span class="n">wolfShore</span> <span class="o">!=</span> <span class="n">goatShore</span> <span class="k">or</span> <span class="n">wolfShore</span> <span class="o">=</span> <span class="n">manShore</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="cp">/** Returns the state that is reached after safely ferrying a cargo item. */</span>
  <span class="n">State</span> <span class="n">safeFerry</span><span class="p">(</span><span class="n">Cargo</span> <span class="n">cargo</span><span class="p">)</span> <span class="p">{</span> <span class="k">result</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="n">ferry</span><span class="p">(</span><span class="n">cargo</span><span class="p">)</span> <span class="k">and</span> <span class="k">result</span><span class="p">.</span><span class="n">isSafe</span><span class="p">()</span> <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="find-paths-from-one-state-to-another">
<h3>Find paths from one state to another<a class="headerlink" href="#find-paths-from-one-state-to-another" title="Permalink to this headline">¶</a></h3>
<p>The main aim of this query is to find a path, that is, a list of successive ferrying actions, to get
from the initial state to the goal state. You could write this “list” by separating each item by a
newline (<code class="docutils literal notranslate"><span class="pre">&quot;\n&quot;</span></code>).</p>
<p>When finding the solution, you should be careful to avoid “infinite” paths. For example, the man
could ferry the goat back and forth any number of times without ever reaching an unsafe state.
Such a path would have an infinite number of river crossings without ever solving the puzzle.</p>
<p>One way to restrict our paths to a finite number of river crossings is to define a
<a class="reference internal" href="../ql-language-reference/types.html#member-predicates"><span class="std std-ref">member predicate</span></a>
<code class="docutils literal notranslate"><span class="pre">State</span> <span class="pre">reachesVia(string</span> <span class="pre">path,</span> <span class="pre">int</span> <span class="pre">steps)</span></code>.
The result of this predicate is any state that is reachable from the current state (<code class="docutils literal notranslate"><span class="pre">this</span></code>) via
the given path in a specified finite number of steps.</p>
<p>You can write this as a <a class="reference internal" href="../ql-language-reference/recursion.html#recursion"><span class="std std-ref">recursive predicate</span></a>,
with the following base case and recursion step:</p>
<blockquote>
<div><ul class="simple">
<li>If <code class="docutils literal notranslate"><span class="pre">this</span></code> <em>is</em> the result state, then it (trivially) reaches the result state via an
empty path in zero steps.</li>
<li>Any other state is reachable if <code class="docutils literal notranslate"><span class="pre">this</span></code> can reach an intermediate state (for some value of
<code class="docutils literal notranslate"><span class="pre">path</span></code> and <code class="docutils literal notranslate"><span class="pre">steps</span></code>), and there is a <code class="docutils literal notranslate"><span class="pre">safeFerry</span></code> action from that intermediate
state to the result state.</li>
</ul>
</div></blockquote>
<p>To ensure that the predicate is finite, you should restrict <code class="docutils literal notranslate"><span class="pre">steps</span></code> to a particular value,
for example <code class="docutils literal notranslate"><span class="pre">steps</span> <span class="pre">&lt;=</span> <span class="pre">7</span></code>.</p>
<div class="toggle docutils container">
<div class="name docutils container">
<em>Show/hide code</em></div>
<div class="highlight-ql notranslate"><div class="highlight"><pre><span></span>  <span class="cp">/**</span>
<span class="cp">   * Returns all states that are reachable via safe ferrying.</span>
<span class="cp">   * `path` keeps track of how it is achieved and `steps` keeps track of the number of steps it takes.</span>
<span class="cp">   */</span>
  <span class="n">State</span> <span class="n">reachesVia</span><span class="p">(</span><span class="kt">string</span> <span class="n">path</span><span class="p">,</span> <span class="kt">int</span> <span class="n">steps</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Trivial case: a state is always reachable from itself</span>
    <span class="n">steps</span> <span class="o">=</span> <span class="m">0</span> <span class="k">and</span> <span class="k">this</span> <span class="o">=</span> <span class="k">result</span> <span class="k">and</span> <span class="n">path</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="k">or</span>
    <span class="c1">// A state is reachable using pathSoFar and then safely ferrying cargo.</span>
    <span class="k">exists</span><span class="p">(</span><span class="kt">int</span> <span class="n">stepsSoFar</span><span class="p">,</span> <span class="kt">string</span> <span class="n">pathSoFar</span><span class="p">,</span> <span class="n">Cargo</span> <span class="n">cargo</span> <span class="o">|</span>
      <span class="k">result</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="n">reachesVia</span><span class="p">(</span><span class="n">pathSoFar</span><span class="p">,</span> <span class="n">stepsSoFar</span><span class="p">).</span><span class="n">safeFerry</span><span class="p">(</span><span class="n">cargo</span><span class="p">)</span> <span class="k">and</span>
      <span class="n">steps</span> <span class="o">=</span> <span class="n">stepsSoFar</span> <span class="o">+</span> <span class="m">1</span> <span class="k">and</span>
      <span class="c1">// We expect a solution in 7 steps, but you can choose any value here.</span>
      <span class="n">steps</span> <span class="o">&lt;=</span> <span class="m">7</span> <span class="k">and</span>
      <span class="n">path</span> <span class="o">=</span> <span class="n">pathSoFar</span> <span class="o">+</span> <span class="s">&quot;\n Ferry &quot;</span> <span class="o">+</span> <span class="n">cargo</span>
    <span class="p">)</span>
  <span class="p">}</span>
</pre></div>
</div>
</div>
<p>However, although this ensures that the solution is finite, it can still contain loops if the upper bound
for <code class="docutils literal notranslate"><span class="pre">steps</span></code> is large. In other words, you could get an inefficient solution by revisiting the same state
multiple times.</p>
<p>Instead of picking an arbitrary upper bound for the number of steps, you can avoid
counting steps altogether. If you keep track of states that have already been visited and ensure
that each ferrying action leads to a new state, the solution certainly won’t contain any loops.</p>
<p>To do this, change the member predicate to <code class="docutils literal notranslate"><span class="pre">State</span> <span class="pre">reachesVia(string</span> <span class="pre">path,</span> <span class="pre">string</span> <span class="pre">visitedStates)</span></code>.
The result of this predicate is any state that is reachable from the current state (<code class="docutils literal notranslate"><span class="pre">this</span></code>) via
the given path without revisiting any previously visited states.</p>
<blockquote>
<div><ul class="simple">
<li>As before, if <code class="docutils literal notranslate"><span class="pre">this</span></code> <em>is</em> the result state, then it (trivially) reaches the result state via an
empty path and an empty string of visited states.</li>
<li>Any other state is reachable if  <code class="docutils literal notranslate"><span class="pre">this</span></code> can reach an intermediate state via some path, without
revisiting any previous states, and there is a <code class="docutils literal notranslate"><span class="pre">safeFerry</span></code> action from the intermediate state to
the result state.
(Hint: To check whether a state has previously been visited, you could check if
there is an <a class="reference external" href="https://codeql.github.com/docs/ql-language-reference/ql-language-specification/#built-ins-for-string">index of</a>
<code class="docutils literal notranslate"><span class="pre">visitedStates</span></code> at which the state occurs.)</li>
</ul>
</div></blockquote>
<div class="toggle docutils container">
<div class="name docutils container">
<em>Show/hide code</em></div>
<div class="highlight-ql notranslate"><div class="highlight"><pre><span></span>  <span class="cp">/**</span>
<span class="cp">   * Returns all states that are reachable via safe ferrying.</span>
<span class="cp">   * `path` keeps track of how it is achieved.</span>
<span class="cp">   * `visitedStates` keeps track of previously visited states and is used to avoid loops.</span>
<span class="cp">   */</span>
  <span class="n">State</span> <span class="n">reachesVia</span><span class="p">(</span><span class="kt">string</span> <span class="n">path</span><span class="p">,</span> <span class="kt">string</span> <span class="n">visitedStates</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Trivial case: a state is always reachable from itself.</span>
    <span class="k">this</span> <span class="o">=</span> <span class="k">result</span> <span class="k">and</span>
    <span class="n">visitedStates</span> <span class="o">=</span> <span class="k">this</span> <span class="k">and</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="k">or</span>
    <span class="c1">// A state is reachable using pathSoFar and then safely ferrying cargo.</span>
    <span class="k">exists</span><span class="p">(</span><span class="kt">string</span> <span class="n">pathSoFar</span><span class="p">,</span> <span class="kt">string</span> <span class="n">visitedStatesSoFar</span><span class="p">,</span> <span class="n">Cargo</span> <span class="n">cargo</span> <span class="o">|</span>
      <span class="k">result</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="n">reachesVia</span><span class="p">(</span><span class="n">pathSoFar</span><span class="p">,</span> <span class="n">visitedStatesSoFar</span><span class="p">).</span><span class="n">safeFerry</span><span class="p">(</span><span class="n">cargo</span><span class="p">)</span> <span class="k">and</span>
      <span class="c1">// The resulting state has not yet been visited.</span>
      <span class="k">not</span> <span class="k">exists</span><span class="p">(</span><span class="n">visitedStatesSoFar</span><span class="p">.</span><span class="n">indexOf</span><span class="p">(</span><span class="k">result</span><span class="p">))</span> <span class="k">and</span>
      <span class="n">visitedStates</span> <span class="o">=</span> <span class="n">visitedStatesSoFar</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="k">result</span> <span class="k">and</span>
      <span class="n">path</span> <span class="o">=</span> <span class="n">pathSoFar</span> <span class="o">+</span> <span class="s">&quot;\n Ferry &quot;</span> <span class="o">+</span> <span class="n">cargo</span>
    <span class="p">)</span>
  <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="display-the-results">
<h3>Display the results<a class="headerlink" href="#display-the-results" title="Permalink to this headline">¶</a></h3>
<p>Once you’ve defined all the necessary classes and predicates, write a <a class="reference internal" href="../ql-language-reference/queries.html#select-clauses"><span class="std std-ref">select clause</span></a>
that returns the resulting path.</p>
<div class="toggle docutils container">
<div class="name docutils container">
<em>Show/hide code</em></div>
<div class="highlight-ql notranslate"><div class="highlight"><pre><span></span><span class="k">from</span> <span class="kt">string</span> <span class="n">path</span>
<span class="k">where</span> <span class="k">any</span><span class="p">(</span><span class="n">InitialState</span> <span class="n">i</span><span class="p">).</span><span class="n">reachesVia</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="k">any</span><span class="p">(</span><span class="n">GoalState</span> <span class="n">g</span><span class="p">)</span>
<span class="k">select</span> <span class="n">path</span>
</pre></div>
</div>
</div>
<p>The <a class="reference internal" href="../ql-language-reference/expressions.html#don-t-care-expressions"><span class="std std-ref">don’t-care expression</span></a> (<code class="docutils literal notranslate"><span class="pre">_</span></code>),
as the second argument to the <code class="docutils literal notranslate"><span class="pre">reachesVia</span></code> predicate, represents any value of <code class="docutils literal notranslate"><span class="pre">visitedStates</span></code>.</p>
<p>For now, the path defined in <code class="docutils literal notranslate"><span class="pre">reachesVia</span></code> just lists the order of cargo items to ferry.
You could tweak the predicate and the select clause to make the solution clearer. Here are some suggestions:</p>
<blockquote>
<div><ul class="simple">
<li>Display more information, such as the direction in which the cargo is ferried, for example
<code class="docutils literal notranslate"><span class="pre">&quot;Goat</span> <span class="pre">to</span> <span class="pre">the</span> <span class="pre">left</span> <span class="pre">shore&quot;</span></code>.</li>
<li>Fully describe the state at every step, for example <code class="docutils literal notranslate"><span class="pre">&quot;Goat:</span> <span class="pre">Left,</span> <span class="pre">Man:</span> <span class="pre">Left,</span> <span class="pre">Cabbage:</span> <span class="pre">Right,</span> <span class="pre">Wolf:</span> <span class="pre">Right&quot;</span></code>.</li>
<li>Display the path in a more “visual” way, for example by using arrows to display the transitions between states.</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="alternative-solutions">
<span id="alternatives"></span><h2>Alternative solutions<a class="headerlink" href="#alternative-solutions" title="Permalink to this headline">¶</a></h2>
<p>Here are some more example queries that solve the river crossing puzzle:</p>
<div class="toggle docutils container">
<div class="name docutils container">
<em>Show/hide example query - modified path</em></div>
<div class="highlight-ql notranslate"><div class="highlight"><pre><span></span><span class="cp">/**</span>
<span class="cp"> * A solution to the river crossing puzzle using a modified `path` variable</span>
<span class="cp"> * to describe the resulting path in detail.</span>
<span class="cp"> */</span>

<span class="cp">/** A possible cargo item. */</span>
<span class="k">class</span> <span class="n">Cargo</span> <span class="k">extends</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="n">Cargo</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Nothing&quot;</span><span class="p">,</span> <span class="s">&quot;Goat&quot;</span><span class="p">,</span> <span class="s">&quot;Cabbage&quot;</span><span class="p">,</span> <span class="s">&quot;Wolf&quot;</span><span class="p">]</span> <span class="p">}</span>
<span class="p">}</span>

<span class="cp">/** A shore, named either `Left` or `Right`. */</span>
<span class="k">class</span> <span class="n">Shore</span> <span class="k">extends</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="n">Shore</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span> <span class="o">=</span> <span class="s">&quot;Left&quot;</span> <span class="k">or</span>
    <span class="k">this</span> <span class="o">=</span> <span class="s">&quot;Right&quot;</span>
  <span class="p">}</span>

  <span class="cp">/** Returns the other shore. */</span>
  <span class="n">Shore</span> <span class="n">other</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span> <span class="o">=</span> <span class="s">&quot;Left&quot;</span> <span class="k">and</span> <span class="k">result</span> <span class="o">=</span> <span class="s">&quot;Right&quot;</span>
    <span class="k">or</span>
    <span class="k">this</span> <span class="o">=</span> <span class="s">&quot;Right&quot;</span> <span class="k">and</span> <span class="k">result</span> <span class="o">=</span> <span class="s">&quot;Left&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cp">/** Renders the state as a string. */</span>
<span class="kt">string</span> <span class="n">renderState</span><span class="p">(</span><span class="n">Shore</span> <span class="n">manShore</span><span class="p">,</span> <span class="n">Shore</span> <span class="n">goatShore</span><span class="p">,</span> <span class="n">Shore</span> <span class="n">cabbageShore</span><span class="p">,</span> <span class="n">Shore</span> <span class="n">wolfShore</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">result</span> <span class="o">=</span> <span class="n">manShore</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">goatShore</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">cabbageShore</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">wolfShore</span>
<span class="p">}</span>

<span class="cp">/** A record of where everything is. */</span>
<span class="k">class</span> <span class="n">State</span> <span class="k">extends</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="n">Shore</span> <span class="n">manShore</span><span class="p">;</span>
  <span class="n">Shore</span> <span class="n">goatShore</span><span class="p">;</span>
  <span class="n">Shore</span> <span class="n">cabbageShore</span><span class="p">;</span>
  <span class="n">Shore</span> <span class="n">wolfShore</span><span class="p">;</span>

  <span class="n">State</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span> <span class="o">=</span> <span class="n">renderState</span><span class="p">(</span><span class="n">manShore</span><span class="p">,</span> <span class="n">goatShore</span><span class="p">,</span> <span class="n">cabbageShore</span><span class="p">,</span> <span class="n">wolfShore</span><span class="p">)</span> <span class="p">}</span>

  <span class="cp">/** Returns the state that is reached after ferrying a particular cargo item. */</span>
  <span class="n">State</span> <span class="n">ferry</span><span class="p">(</span><span class="n">Cargo</span> <span class="n">cargo</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cargo</span> <span class="o">=</span> <span class="s">&quot;Nothing&quot;</span> <span class="k">and</span>
    <span class="k">result</span> <span class="o">=</span> <span class="n">renderState</span><span class="p">(</span><span class="n">manShore</span><span class="p">.</span><span class="n">other</span><span class="p">(),</span> <span class="n">goatShore</span><span class="p">,</span> <span class="n">cabbageShore</span><span class="p">,</span> <span class="n">wolfShore</span><span class="p">)</span>
    <span class="k">or</span>
    <span class="n">cargo</span> <span class="o">=</span> <span class="s">&quot;Goat&quot;</span> <span class="k">and</span>
    <span class="k">result</span> <span class="o">=</span> <span class="n">renderState</span><span class="p">(</span><span class="n">manShore</span><span class="p">.</span><span class="n">other</span><span class="p">(),</span> <span class="n">goatShore</span><span class="p">.</span><span class="n">other</span><span class="p">(),</span> <span class="n">cabbageShore</span><span class="p">,</span> <span class="n">wolfShore</span><span class="p">)</span>
    <span class="k">or</span>
    <span class="n">cargo</span> <span class="o">=</span> <span class="s">&quot;Cabbage&quot;</span> <span class="k">and</span>
    <span class="k">result</span> <span class="o">=</span> <span class="n">renderState</span><span class="p">(</span><span class="n">manShore</span><span class="p">.</span><span class="n">other</span><span class="p">(),</span> <span class="n">goatShore</span><span class="p">,</span> <span class="n">cabbageShore</span><span class="p">.</span><span class="n">other</span><span class="p">(),</span> <span class="n">wolfShore</span><span class="p">)</span>
    <span class="k">or</span>
    <span class="n">cargo</span> <span class="o">=</span> <span class="s">&quot;Wolf&quot;</span> <span class="k">and</span>
    <span class="k">result</span> <span class="o">=</span> <span class="n">renderState</span><span class="p">(</span><span class="n">manShore</span><span class="p">.</span><span class="n">other</span><span class="p">(),</span> <span class="n">goatShore</span><span class="p">,</span> <span class="n">cabbageShore</span><span class="p">,</span> <span class="n">wolfShore</span><span class="p">.</span><span class="n">other</span><span class="p">())</span>
  <span class="p">}</span>

  <span class="cp">/**</span>
<span class="cp">   * Holds if the state is safe. This occurs when neither the goat nor the cabbage</span>
<span class="cp">   * can get eaten.</span>
<span class="cp">   */</span>
  <span class="k">predicate</span> <span class="n">isSafe</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// The goat can&#39;t eat the cabbage.</span>
    <span class="p">(</span><span class="n">goatShore</span> <span class="o">!=</span> <span class="n">cabbageShore</span> <span class="k">or</span> <span class="n">goatShore</span> <span class="o">=</span> <span class="n">manShore</span><span class="p">)</span> <span class="k">and</span>
    <span class="c1">// The wolf can&#39;t eat the goat.</span>
    <span class="p">(</span><span class="n">wolfShore</span> <span class="o">!=</span> <span class="n">goatShore</span> <span class="k">or</span> <span class="n">wolfShore</span> <span class="o">=</span> <span class="n">manShore</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="cp">/** Returns the state that is reached after safely ferrying a cargo item. */</span>
  <span class="n">State</span> <span class="n">safeFerry</span><span class="p">(</span><span class="n">Cargo</span> <span class="n">cargo</span><span class="p">)</span> <span class="p">{</span> <span class="k">result</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="n">ferry</span><span class="p">(</span><span class="n">cargo</span><span class="p">)</span> <span class="k">and</span> <span class="k">result</span><span class="p">.</span><span class="n">isSafe</span><span class="p">()</span> <span class="p">}</span>

  <span class="kt">string</span> <span class="n">towards</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">manShore</span> <span class="o">=</span> <span class="s">&quot;Left&quot;</span> <span class="k">and</span> <span class="k">result</span> <span class="o">=</span> <span class="s">&quot;to the left&quot;</span>
    <span class="k">or</span>
    <span class="n">manShore</span> <span class="o">=</span> <span class="s">&quot;Right&quot;</span> <span class="k">and</span> <span class="k">result</span> <span class="o">=</span> <span class="s">&quot;to the right&quot;</span>
  <span class="p">}</span>

  <span class="cp">/**</span>
<span class="cp">   * Returns all states that are reachable via safe ferrying.</span>
<span class="cp">   * `path` keeps track of how it is achieved.</span>
<span class="cp">   * `visitedStates` keeps track of previously visited states and is used to avoid loops.</span>
<span class="cp">   */</span>
  <span class="n">State</span> <span class="n">reachesVia</span><span class="p">(</span><span class="kt">string</span> <span class="n">path</span><span class="p">,</span> <span class="kt">string</span> <span class="n">visitedStates</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Reachable in 1 step by ferrying a specific cargo</span>
    <span class="k">exists</span><span class="p">(</span><span class="n">Cargo</span> <span class="n">cargo</span> <span class="o">|</span>
      <span class="k">result</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="n">safeFerry</span><span class="p">(</span><span class="n">cargo</span><span class="p">)</span> <span class="k">and</span>
      <span class="n">visitedStates</span> <span class="o">=</span> <span class="k">result</span> <span class="k">and</span>
      <span class="n">path</span> <span class="o">=</span> <span class="s">&quot;First &quot;</span> <span class="o">+</span> <span class="n">cargo</span> <span class="o">+</span> <span class="s">&quot; is ferried &quot;</span> <span class="o">+</span> <span class="k">result</span><span class="p">.</span><span class="n">towards</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="k">or</span>
    <span class="c1">// Reachable by first following pathSoFar and then ferrying cargo</span>
    <span class="k">exists</span><span class="p">(</span><span class="kt">string</span> <span class="n">pathSoFar</span><span class="p">,</span> <span class="kt">string</span> <span class="n">visitedStatesSoFar</span><span class="p">,</span> <span class="n">Cargo</span> <span class="n">cargo</span> <span class="o">|</span>
      <span class="k">result</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="n">reachesVia</span><span class="p">(</span><span class="n">pathSoFar</span><span class="p">,</span> <span class="n">visitedStatesSoFar</span><span class="p">).</span><span class="n">safeFerry</span><span class="p">(</span><span class="n">cargo</span><span class="p">)</span> <span class="k">and</span>
      <span class="k">not</span> <span class="k">exists</span><span class="p">(</span><span class="n">visitedStatesSoFar</span><span class="p">.</span><span class="n">indexOf</span><span class="p">(</span><span class="k">result</span><span class="p">))</span> <span class="k">and</span> <span class="c1">// resulting state is not visited yet</span>
      <span class="n">visitedStates</span> <span class="o">=</span> <span class="n">visitedStatesSoFar</span> <span class="o">+</span> <span class="s">&quot;_&quot;</span> <span class="o">+</span> <span class="k">result</span> <span class="k">and</span>
      <span class="n">path</span> <span class="o">=</span> <span class="n">pathSoFar</span> <span class="o">+</span> <span class="s">&quot;,\nthen &quot;</span> <span class="o">+</span> <span class="n">cargo</span> <span class="o">+</span> <span class="s">&quot; is ferried &quot;</span> <span class="o">+</span> <span class="k">result</span><span class="p">.</span><span class="n">towards</span><span class="p">()</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cp">/** The initial state, where everything is on the left shore. */</span>
<span class="k">class</span> <span class="n">InitialState</span> <span class="k">extends</span> <span class="n">State</span> <span class="p">{</span>
  <span class="n">InitialState</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span> <span class="o">=</span> <span class="n">renderState</span><span class="p">(</span><span class="s">&quot;Left&quot;</span><span class="p">,</span> <span class="s">&quot;Left&quot;</span><span class="p">,</span> <span class="s">&quot;Left&quot;</span><span class="p">,</span> <span class="s">&quot;Left&quot;</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>

<span class="cp">/** The goal state, where everything is on the right shore. */</span>
<span class="k">class</span> <span class="n">GoalState</span> <span class="k">extends</span> <span class="n">State</span> <span class="p">{</span>
  <span class="n">GoalState</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span> <span class="o">=</span> <span class="n">renderState</span><span class="p">(</span><span class="s">&quot;Right&quot;</span><span class="p">,</span> <span class="s">&quot;Right&quot;</span><span class="p">,</span> <span class="s">&quot;Right&quot;</span><span class="p">,</span> <span class="s">&quot;Right&quot;</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">from</span> <span class="kt">string</span> <span class="n">path</span>
<span class="k">where</span> <span class="k">any</span><span class="p">(</span><span class="n">InitialState</span> <span class="n">i</span><span class="p">).</span><span class="n">reachesVia</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="k">any</span><span class="p">(</span><span class="n">GoalState</span> <span class="n">g</span><span class="p">)</span>
<span class="k">select</span> <span class="n">path</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span>
</pre></div>
</div>
</div>
<div class="toggle docutils container">
<div class="name docutils container">
<em>Show/hide example query - abstract class</em></div>
<div class="highlight-ql notranslate"><div class="highlight"><pre><span></span><span class="cp">/**</span>
<span class="cp"> * A solution to the river crossing puzzle using abstract</span>
<span class="cp"> * classes/predicates to model the situation and unicode</span>
<span class="cp"> * symbols to display the answer.</span>
<span class="cp"> */</span>

<span class="cp">/** One of two shores. */</span>
<span class="k">class</span> <span class="n">Shore</span> <span class="k">extends</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="n">Shore</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span> <span class="o">=</span> <span class="s">&quot;left&quot;</span> <span class="k">or</span> <span class="k">this</span> <span class="o">=</span> <span class="s">&quot;right&quot;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="cp">/** Models the behavior of the man. */</span>
<span class="k">class</span> <span class="n">Man</span> <span class="k">extends</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="n">Shore</span> <span class="n">s</span><span class="p">;</span>

  <span class="n">Man</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span> <span class="o">=</span> <span class="s">&quot;man &quot;</span> <span class="o">+</span> <span class="n">s</span> <span class="p">}</span>

  <span class="cp">/** Holds if the man is on a particular shore. */</span>
  <span class="k">predicate</span> <span class="n">isOn</span><span class="p">(</span><span class="n">Shore</span> <span class="n">shore</span><span class="p">)</span> <span class="p">{</span> <span class="n">s</span> <span class="o">=</span> <span class="n">shore</span> <span class="p">}</span>

  <span class="cp">/** Returns the other shore, after the man crosses the river. */</span>
  <span class="n">Man</span> <span class="n">cross</span><span class="p">()</span> <span class="p">{</span> <span class="k">result</span> <span class="o">!=</span> <span class="k">this</span> <span class="p">}</span>

  <span class="cp">/** Returns a cargo and its position after being ferried. */</span>
  <span class="n">Cargo</span> <span class="n">ferry</span><span class="p">(</span><span class="n">Cargo</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">result</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">cross</span><span class="p">()</span> <span class="k">and</span>
    <span class="n">c</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cp">/** One of three possible cargo items, with their position. */</span>
<span class="kr">abstract </span><span class="k">class</span> <span class="n">Cargo</span> <span class="k">extends</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="n">Shore</span> <span class="n">s</span><span class="p">;</span>

  <span class="kr">bindingset[this]</span>
  <span class="n">Cargo</span><span class="p">()</span> <span class="p">{</span> <span class="k">any</span><span class="p">()</span> <span class="p">}</span>

  <span class="cp">/** Holds if the cargo is on a particular shore. */</span>
  <span class="k">predicate</span> <span class="n">isOn</span><span class="p">(</span><span class="n">Shore</span> <span class="n">shore</span><span class="p">)</span> <span class="p">{</span> <span class="n">s</span> <span class="o">=</span> <span class="n">shore</span> <span class="p">}</span>

  <span class="cp">/** Returns the other shore, after the cargo crosses the river. */</span>
  <span class="kr">abstract </span><span class="n">Cargo</span> <span class="n">cross</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">/** Models the position of the goat. */</span>
<span class="k">class</span> <span class="n">Goat</span> <span class="k">extends</span> <span class="n">Cargo</span> <span class="p">{</span>
  <span class="n">Goat</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span> <span class="o">=</span> <span class="s">&quot;goat &quot;</span> <span class="o">+</span> <span class="n">s</span> <span class="p">}</span>

  <span class="kr">override </span><span class="n">Goat</span> <span class="n">cross</span><span class="p">()</span> <span class="p">{</span> <span class="k">result</span> <span class="o">!=</span> <span class="k">this</span> <span class="p">}</span>
<span class="p">}</span>

<span class="cp">/** Models the position of the wolf. */</span>
<span class="k">class</span> <span class="n">Wolf</span> <span class="k">extends</span> <span class="n">Cargo</span> <span class="p">{</span>
  <span class="n">Wolf</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span> <span class="o">=</span> <span class="s">&quot;wolf &quot;</span> <span class="o">+</span> <span class="n">s</span> <span class="p">}</span>

  <span class="kr">override </span><span class="n">Wolf</span> <span class="n">cross</span><span class="p">()</span> <span class="p">{</span> <span class="k">result</span> <span class="o">!=</span> <span class="k">this</span> <span class="p">}</span>
<span class="p">}</span>

<span class="cp">/** Models the position of the cabbage. */</span>
<span class="k">class</span> <span class="n">Cabbage</span> <span class="k">extends</span> <span class="n">Cargo</span> <span class="p">{</span>
  <span class="n">Cabbage</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span> <span class="o">=</span> <span class="s">&quot;cabbage &quot;</span> <span class="o">+</span> <span class="n">s</span> <span class="p">}</span>

  <span class="kr">override </span><span class="n">Cabbage</span> <span class="n">cross</span><span class="p">()</span> <span class="p">{</span> <span class="k">result</span> <span class="o">!=</span> <span class="k">this</span> <span class="p">}</span>
<span class="p">}</span>

<span class="cp">/** Returns a unicode representation of everything on the left shore. */</span>
<span class="kt">string</span> <span class="n">onLeft</span><span class="p">(</span><span class="n">Man</span> <span class="n">man</span><span class="p">,</span> <span class="n">Goat</span> <span class="n">goat</span><span class="p">,</span> <span class="n">Cabbage</span> <span class="n">cabbage</span><span class="p">,</span> <span class="n">Wolf</span> <span class="n">wolf</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">exists</span><span class="p">(</span><span class="kt">string</span> <span class="n">manOnLeft</span><span class="p">,</span> <span class="kt">string</span> <span class="n">goatOnLeft</span><span class="p">,</span> <span class="kt">string</span> <span class="n">cabbageOnLeft</span><span class="p">,</span> <span class="kt">string</span> <span class="n">wolfOnLeft</span> <span class="o">|</span>
    <span class="p">(</span>
      <span class="n">man</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="s">&quot;left&quot;</span><span class="p">)</span> <span class="k">and</span> <span class="n">manOnLeft</span> <span class="o">=</span> <span class="s">&quot;🕴&quot;</span>
      <span class="k">or</span>
      <span class="n">man</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="s">&quot;right&quot;</span><span class="p">)</span> <span class="k">and</span> <span class="n">manOnLeft</span> <span class="o">=</span> <span class="s">&quot;____&quot;</span>
    <span class="p">)</span> <span class="k">and</span>
    <span class="p">(</span>
      <span class="n">goat</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="s">&quot;left&quot;</span><span class="p">)</span> <span class="k">and</span> <span class="n">goatOnLeft</span> <span class="o">=</span> <span class="s">&quot;🐐&quot;</span>
      <span class="k">or</span>
      <span class="n">goat</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="s">&quot;right&quot;</span><span class="p">)</span> <span class="k">and</span> <span class="n">goatOnLeft</span> <span class="o">=</span> <span class="s">&quot;___&quot;</span>
    <span class="p">)</span> <span class="k">and</span>
    <span class="p">(</span>
      <span class="n">cabbage</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="s">&quot;left&quot;</span><span class="p">)</span> <span class="k">and</span> <span class="n">cabbageOnLeft</span> <span class="o">=</span> <span class="s">&quot;🥬&quot;</span>
      <span class="k">or</span>
      <span class="n">cabbage</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="s">&quot;right&quot;</span><span class="p">)</span> <span class="k">and</span> <span class="n">cabbageOnLeft</span> <span class="o">=</span> <span class="s">&quot;___&quot;</span>
    <span class="p">)</span> <span class="k">and</span>
    <span class="p">(</span>
      <span class="n">wolf</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="s">&quot;left&quot;</span><span class="p">)</span> <span class="k">and</span> <span class="n">wolfOnLeft</span> <span class="o">=</span> <span class="s">&quot;🐺&quot;</span>
      <span class="k">or</span>
      <span class="n">wolf</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="s">&quot;right&quot;</span><span class="p">)</span> <span class="k">and</span> <span class="n">wolfOnLeft</span> <span class="o">=</span> <span class="s">&quot;___&quot;</span>
    <span class="p">)</span> <span class="k">and</span>
    <span class="k">result</span> <span class="o">=</span> <span class="n">manOnLeft</span> <span class="o">+</span> <span class="s">&quot;__&quot;</span> <span class="o">+</span> <span class="n">goatOnLeft</span> <span class="o">+</span> <span class="s">&quot;__&quot;</span> <span class="o">+</span> <span class="n">cabbageOnLeft</span> <span class="o">+</span> <span class="s">&quot;__&quot;</span> <span class="o">+</span> <span class="n">wolfOnLeft</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="cp">/** Returns a unicode representation of everything on the right shore. */</span>
<span class="kt">string</span> <span class="n">onRight</span><span class="p">(</span><span class="n">Man</span> <span class="n">man</span><span class="p">,</span> <span class="n">Goat</span> <span class="n">goat</span><span class="p">,</span> <span class="n">Cabbage</span> <span class="n">cabbage</span><span class="p">,</span> <span class="n">Wolf</span> <span class="n">wolf</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">exists</span><span class="p">(</span><span class="kt">string</span> <span class="n">manOnLeft</span><span class="p">,</span> <span class="kt">string</span> <span class="n">goatOnLeft</span><span class="p">,</span> <span class="kt">string</span> <span class="n">cabbageOnLeft</span><span class="p">,</span> <span class="kt">string</span> <span class="n">wolfOnLeft</span> <span class="o">|</span>
    <span class="p">(</span>
      <span class="n">man</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="s">&quot;right&quot;</span><span class="p">)</span> <span class="k">and</span> <span class="n">manOnLeft</span> <span class="o">=</span> <span class="s">&quot;🕴&quot;</span>
      <span class="k">or</span>
      <span class="n">man</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="s">&quot;left&quot;</span><span class="p">)</span> <span class="k">and</span> <span class="n">manOnLeft</span> <span class="o">=</span> <span class="s">&quot;_&quot;</span>
    <span class="p">)</span> <span class="k">and</span>
    <span class="p">(</span>
      <span class="n">goat</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="s">&quot;right&quot;</span><span class="p">)</span> <span class="k">and</span> <span class="n">goatOnLeft</span> <span class="o">=</span> <span class="s">&quot;🐐&quot;</span>
      <span class="k">or</span>
      <span class="n">goat</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="s">&quot;left&quot;</span><span class="p">)</span> <span class="k">and</span> <span class="n">goatOnLeft</span> <span class="o">=</span> <span class="s">&quot;__&quot;</span>
    <span class="p">)</span> <span class="k">and</span>
    <span class="p">(</span>
      <span class="n">cabbage</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="s">&quot;right&quot;</span><span class="p">)</span> <span class="k">and</span> <span class="n">cabbageOnLeft</span> <span class="o">=</span> <span class="s">&quot;🥬&quot;</span>
      <span class="k">or</span>
      <span class="n">cabbage</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="s">&quot;left&quot;</span><span class="p">)</span> <span class="k">and</span> <span class="n">cabbageOnLeft</span> <span class="o">=</span> <span class="s">&quot;__&quot;</span>
    <span class="p">)</span> <span class="k">and</span>
    <span class="p">(</span>
      <span class="n">wolf</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="s">&quot;right&quot;</span><span class="p">)</span> <span class="k">and</span> <span class="n">wolfOnLeft</span> <span class="o">=</span> <span class="s">&quot;🐺&quot;</span>
      <span class="k">or</span>
      <span class="n">wolf</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="s">&quot;left&quot;</span><span class="p">)</span> <span class="k">and</span> <span class="n">wolfOnLeft</span> <span class="o">=</span> <span class="s">&quot;__&quot;</span>
    <span class="p">)</span> <span class="k">and</span>
    <span class="k">result</span> <span class="o">=</span> <span class="n">manOnLeft</span> <span class="o">+</span> <span class="s">&quot;__&quot;</span> <span class="o">+</span> <span class="n">goatOnLeft</span> <span class="o">+</span> <span class="s">&quot;__&quot;</span> <span class="o">+</span> <span class="n">cabbageOnLeft</span> <span class="o">+</span> <span class="s">&quot;__&quot;</span> <span class="o">+</span> <span class="n">wolfOnLeft</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="cp">/** Renders the state as a string, using unicode symbols. */</span>
<span class="kt">string</span> <span class="n">render</span><span class="p">(</span><span class="n">Man</span> <span class="n">man</span><span class="p">,</span> <span class="n">Goat</span> <span class="n">goat</span><span class="p">,</span> <span class="n">Cabbage</span> <span class="n">cabbage</span><span class="p">,</span> <span class="n">Wolf</span> <span class="n">wolf</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">result</span> <span class="o">=</span>
    <span class="n">onLeft</span><span class="p">(</span><span class="n">man</span><span class="p">,</span> <span class="n">goat</span><span class="p">,</span> <span class="n">cabbage</span><span class="p">,</span> <span class="n">wolf</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;___🌊🌊🌊🌊🌊🌊🌊🌊🌊🌊___&quot;</span> <span class="o">+</span>
      <span class="n">onRight</span><span class="p">(</span><span class="n">man</span><span class="p">,</span> <span class="n">goat</span><span class="p">,</span> <span class="n">cabbage</span><span class="p">,</span> <span class="n">wolf</span><span class="p">)</span>
<span class="p">}</span>

<span class="cp">/** A record of where everything is. */</span>
<span class="k">class</span> <span class="n">State</span> <span class="k">extends</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="n">Man</span> <span class="n">man</span><span class="p">;</span>
  <span class="n">Goat</span> <span class="n">goat</span><span class="p">;</span>
  <span class="n">Cabbage</span> <span class="n">cabbage</span><span class="p">;</span>
  <span class="n">Wolf</span> <span class="n">wolf</span><span class="p">;</span>

  <span class="n">State</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span> <span class="o">=</span> <span class="n">render</span><span class="p">(</span><span class="n">man</span><span class="p">,</span> <span class="n">goat</span><span class="p">,</span> <span class="n">cabbage</span><span class="p">,</span> <span class="n">wolf</span><span class="p">)</span> <span class="p">}</span>

  <span class="cp">/**</span>
<span class="cp">   * Returns the possible states that you can transition to</span>
<span class="cp">   * by ferrying one or zero cargo items.</span>
<span class="cp">   */</span>
  <span class="n">State</span> <span class="n">transition</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">result</span> <span class="o">=</span> <span class="n">render</span><span class="p">(</span><span class="n">man</span><span class="p">.</span><span class="n">cross</span><span class="p">(),</span> <span class="n">man</span><span class="p">.</span><span class="n">ferry</span><span class="p">(</span><span class="n">goat</span><span class="p">),</span> <span class="n">cabbage</span><span class="p">,</span> <span class="n">wolf</span><span class="p">)</span> <span class="k">or</span>
    <span class="k">result</span> <span class="o">=</span> <span class="n">render</span><span class="p">(</span><span class="n">man</span><span class="p">.</span><span class="n">cross</span><span class="p">(),</span> <span class="n">goat</span><span class="p">,</span> <span class="n">man</span><span class="p">.</span><span class="n">ferry</span><span class="p">(</span><span class="n">cabbage</span><span class="p">),</span> <span class="n">wolf</span><span class="p">)</span> <span class="k">or</span>
    <span class="k">result</span> <span class="o">=</span> <span class="n">render</span><span class="p">(</span><span class="n">man</span><span class="p">.</span><span class="n">cross</span><span class="p">(),</span> <span class="n">goat</span><span class="p">,</span> <span class="n">cabbage</span><span class="p">,</span> <span class="n">man</span><span class="p">.</span><span class="n">ferry</span><span class="p">(</span><span class="n">wolf</span><span class="p">))</span> <span class="k">or</span>
    <span class="k">result</span> <span class="o">=</span> <span class="n">render</span><span class="p">(</span><span class="n">man</span><span class="p">.</span><span class="n">cross</span><span class="p">(),</span> <span class="n">goat</span><span class="p">,</span> <span class="n">cabbage</span><span class="p">,</span> <span class="n">wolf</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="cp">/**</span>
<span class="cp">   * Returns all states that are reachable via a transition</span>
<span class="cp">   * and have not yet been visited.</span>
<span class="cp">   * `path` keeps track of how it is achieved.</span>
<span class="cp">   */</span>
  <span class="n">State</span> <span class="n">reachesVia</span><span class="p">(</span><span class="kt">string</span> <span class="n">path</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">exists</span><span class="p">(</span><span class="kt">string</span> <span class="n">pathSoFar</span> <span class="o">|</span>
      <span class="k">result</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="n">reachesVia</span><span class="p">(</span><span class="n">pathSoFar</span><span class="p">).</span><span class="n">transition</span><span class="p">()</span> <span class="k">and</span>
      <span class="k">not</span> <span class="k">exists</span><span class="p">(</span><span class="n">pathSoFar</span><span class="p">.</span><span class="n">indexOf</span><span class="p">(</span><span class="k">result</span><span class="p">.</span><span class="n">toString</span><span class="p">()))</span> <span class="k">and</span>
      <span class="n">path</span> <span class="o">=</span> <span class="n">pathSoFar</span> <span class="o">+</span> <span class="s">&quot;\n↓\n&quot;</span> <span class="o">+</span> <span class="k">result</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cp">/** The initial state, where everything is on the left shore. */</span>
<span class="k">class</span> <span class="n">InitialState</span> <span class="k">extends</span> <span class="n">State</span> <span class="p">{</span>
  <span class="n">InitialState</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">exists</span><span class="p">(</span><span class="n">Shore</span> <span class="n">left</span> <span class="o">|</span> <span class="n">left</span> <span class="o">=</span> <span class="s">&quot;left&quot;</span> <span class="o">|</span>
      <span class="n">man</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">left</span><span class="p">)</span> <span class="k">and</span> <span class="n">goat</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">left</span><span class="p">)</span> <span class="k">and</span> <span class="n">cabbage</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">left</span><span class="p">)</span> <span class="k">and</span> <span class="n">wolf</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">left</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="p">}</span>

  <span class="kr">override </span><span class="n">State</span> <span class="n">reachesVia</span><span class="p">(</span><span class="kt">string</span> <span class="n">path</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">path</span> <span class="o">=</span> <span class="k">this</span> <span class="o">+</span> <span class="s">&quot;\n↓\n&quot;</span> <span class="o">+</span> <span class="k">result</span> <span class="k">and</span> <span class="k">result</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="n">transition</span><span class="p">()</span>
    <span class="k">or</span>
    <span class="k">result</span> <span class="o">=</span> <span class="k">super</span><span class="p">.</span><span class="n">reachesVia</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cp">/** The goal state, where everything is on the right shore. */</span>
<span class="k">class</span> <span class="n">GoalState</span> <span class="k">extends</span> <span class="n">State</span> <span class="p">{</span>
  <span class="n">GoalState</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">exists</span><span class="p">(</span><span class="n">Shore</span> <span class="n">right</span> <span class="o">|</span> <span class="n">right</span> <span class="o">=</span> <span class="s">&quot;right&quot;</span> <span class="o">|</span>
      <span class="n">man</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">right</span><span class="p">)</span> <span class="k">and</span> <span class="n">goat</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">right</span><span class="p">)</span> <span class="k">and</span> <span class="n">cabbage</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">right</span><span class="p">)</span> <span class="k">and</span> <span class="n">wolf</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="p">}</span>

  <span class="kr">override </span><span class="n">State</span> <span class="n">transition</span><span class="p">()</span> <span class="p">{</span> <span class="k">none</span><span class="p">()</span> <span class="p">}</span>
<span class="p">}</span>

<span class="cp">/** An unsafe state, where something gets eaten. */</span>
<span class="k">class</span> <span class="n">IllegalState</span> <span class="k">extends</span> <span class="n">State</span> <span class="p">{</span>
  <span class="n">IllegalState</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">exists</span><span class="p">(</span><span class="n">Shore</span> <span class="n">s</span> <span class="o">|</span>
      <span class="n">goat</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">and</span> <span class="n">cabbage</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">and</span> <span class="k">not</span> <span class="n">man</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
      <span class="k">or</span>
      <span class="n">wolf</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">and</span> <span class="n">goat</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">and</span> <span class="k">not</span> <span class="n">man</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="p">}</span>

  <span class="kr">override </span><span class="n">State</span> <span class="n">transition</span><span class="p">()</span> <span class="p">{</span> <span class="k">none</span><span class="p">()</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">from</span> <span class="kt">string</span> <span class="n">path</span>
<span class="k">where</span> <span class="k">any</span><span class="p">(</span><span class="n">InitialState</span> <span class="n">i</span><span class="p">).</span><span class="n">reachesVia</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">=</span> <span class="k">any</span><span class="p">(</span><span class="n">GoalState</span> <span class="n">g</span><span class="p">)</span>
<span class="k">select</span> <span class="n">path</span>
</pre></div>
</div>
</div>
<div class="toggle docutils container">
<div class="name docutils container">
<em>Show/hide example query - datatypes</em></div>
<div class="highlight-ql notranslate"><div class="highlight"><pre><span></span><span class="cp">/**</span>
<span class="cp"> * &quot;Typesafe&quot; solution to the river crossing puzzle.</span>
<span class="cp"> */</span>

<span class="cp">/** Either the left shore or the right shore. */</span>
<span class="k">newtype</span> <span class="n">TShore</span> <span class="o">=</span>
  <span class="n">Left</span><span class="p">()</span> <span class="k">or</span>
  <span class="n">Right</span><span class="p">()</span>

<span class="k">class</span> <span class="n">Shore</span> <span class="k">extends</span> <span class="n">TShore</span> <span class="p">{</span>
  <span class="n">Shore</span> <span class="n">other</span><span class="p">()</span> <span class="p">{</span> <span class="k">result</span> <span class="o">!=</span> <span class="k">this</span> <span class="p">}</span>

  <span class="kt">string</span> <span class="n">toString</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span> <span class="o">=</span> <span class="n">Left</span><span class="p">()</span> <span class="k">and</span> <span class="k">result</span> <span class="o">=</span> <span class="s">&quot;left&quot;</span>
    <span class="k">or</span>
    <span class="k">this</span> <span class="o">=</span> <span class="n">Right</span><span class="p">()</span> <span class="k">and</span> <span class="k">result</span> <span class="o">=</span> <span class="s">&quot;right&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">newtype</span> <span class="n">TMan</span> <span class="o">=</span> <span class="n">TManOn</span><span class="p">(</span><span class="n">Shore</span> <span class="n">s</span><span class="p">)</span>

<span class="cp">/** Models the behavior of the man. */</span>
<span class="k">class</span> <span class="n">Man</span> <span class="k">extends</span> <span class="n">TMan</span> <span class="p">{</span>
  <span class="n">Shore</span> <span class="n">s</span><span class="p">;</span>

  <span class="n">Man</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span> <span class="o">=</span> <span class="n">TManOn</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">}</span>

  <span class="cp">/** Holds if the man is on a particular shore. */</span>
  <span class="k">predicate</span> <span class="n">isOn</span><span class="p">(</span><span class="n">Shore</span> <span class="n">shore</span><span class="p">)</span> <span class="p">{</span> <span class="n">s</span> <span class="o">=</span> <span class="n">shore</span> <span class="p">}</span>

  <span class="cp">/** Returns the other shore, after the man crosses the river. */</span>
  <span class="n">Man</span> <span class="n">cross</span><span class="p">()</span> <span class="p">{</span> <span class="k">result</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">other</span><span class="p">())</span> <span class="p">}</span>

  <span class="cp">/** Returns a cargo and its position after being ferried. */</span>
  <span class="n">Cargo</span> <span class="n">ferry</span><span class="p">(</span><span class="n">Cargo</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">result</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">cross</span><span class="p">()</span> <span class="k">and</span>
    <span class="n">c</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="kt">string</span> <span class="n">toString</span><span class="p">()</span> <span class="p">{</span> <span class="k">result</span> <span class="o">=</span> <span class="s">&quot;man &quot;</span> <span class="o">+</span> <span class="n">s</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">newtype</span> <span class="n">TCargo</span> <span class="o">=</span>
  <span class="n">TGoat</span><span class="p">(</span><span class="n">Shore</span> <span class="n">s</span><span class="p">)</span> <span class="k">or</span>
  <span class="n">TCabbage</span><span class="p">(</span><span class="n">Shore</span> <span class="n">s</span><span class="p">)</span> <span class="k">or</span>
  <span class="n">TWolf</span><span class="p">(</span><span class="n">Shore</span> <span class="n">s</span><span class="p">)</span>

<span class="cp">/** One of three possible cargo items, with their position. */</span>
<span class="kr">abstract </span><span class="k">class</span> <span class="n">Cargo</span> <span class="k">extends</span> <span class="n">TCargo</span> <span class="p">{</span>
  <span class="n">Shore</span> <span class="n">s</span><span class="p">;</span>

  <span class="cp">/** Holds if the cargo is on a particular shore. */</span>
  <span class="k">predicate</span> <span class="n">isOn</span><span class="p">(</span><span class="n">Shore</span> <span class="n">shore</span><span class="p">)</span> <span class="p">{</span> <span class="n">s</span> <span class="o">=</span> <span class="n">shore</span> <span class="p">}</span>

  <span class="cp">/** Returns the other shore, after the cargo crosses the river. */</span>
  <span class="kr">abstract </span><span class="n">Cargo</span> <span class="n">cross</span><span class="p">();</span>

  <span class="kr">abstract </span><span class="kt">string</span> <span class="n">toString</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">/** Models the position of the goat. */</span>
<span class="k">class</span> <span class="n">Goat</span> <span class="k">extends</span> <span class="n">Cargo</span><span class="p">,</span> <span class="n">TGoat</span> <span class="p">{</span>
  <span class="n">Goat</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span> <span class="o">=</span> <span class="n">TGoat</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">}</span>

  <span class="kr">override </span><span class="n">Cargo</span> <span class="n">cross</span><span class="p">()</span> <span class="p">{</span> <span class="k">result</span> <span class="o">=</span> <span class="n">TGoat</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">other</span><span class="p">())</span> <span class="p">}</span>

  <span class="kr">override </span><span class="kt">string</span> <span class="n">toString</span><span class="p">()</span> <span class="p">{</span> <span class="k">result</span> <span class="o">=</span> <span class="s">&quot;goat &quot;</span> <span class="o">+</span> <span class="n">s</span> <span class="p">}</span>
<span class="p">}</span>

<span class="cp">/** Models the position of the wolf. */</span>
<span class="k">class</span> <span class="n">Wolf</span> <span class="k">extends</span> <span class="n">Cargo</span><span class="p">,</span> <span class="n">TWolf</span> <span class="p">{</span>
  <span class="n">Wolf</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span> <span class="o">=</span> <span class="n">TWolf</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">}</span>

  <span class="kr">override </span><span class="n">Cargo</span> <span class="n">cross</span><span class="p">()</span> <span class="p">{</span> <span class="k">result</span> <span class="o">=</span> <span class="n">TWolf</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">other</span><span class="p">())</span> <span class="p">}</span>

  <span class="kr">override </span><span class="kt">string</span> <span class="n">toString</span><span class="p">()</span> <span class="p">{</span> <span class="k">result</span> <span class="o">=</span> <span class="s">&quot;wolf &quot;</span> <span class="o">+</span> <span class="n">s</span> <span class="p">}</span>
<span class="p">}</span>

<span class="cp">/** Models the position of the cabbage. */</span>
<span class="k">class</span> <span class="n">Cabbage</span> <span class="k">extends</span> <span class="n">Cargo</span><span class="p">,</span> <span class="n">TCabbage</span> <span class="p">{</span>
  <span class="n">Cabbage</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span> <span class="o">=</span> <span class="n">TCabbage</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">}</span>

  <span class="kr">override </span><span class="n">Cargo</span> <span class="n">cross</span><span class="p">()</span> <span class="p">{</span> <span class="k">result</span> <span class="o">=</span> <span class="n">TCabbage</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">other</span><span class="p">())</span> <span class="p">}</span>

  <span class="kr">override </span><span class="kt">string</span> <span class="n">toString</span><span class="p">()</span> <span class="p">{</span> <span class="k">result</span> <span class="o">=</span> <span class="s">&quot;cabbage &quot;</span> <span class="o">+</span> <span class="n">s</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">newtype</span> <span class="n">TState</span> <span class="o">=</span> <span class="n">Currently</span><span class="p">(</span><span class="n">Man</span> <span class="n">man</span><span class="p">,</span> <span class="n">Goat</span> <span class="n">goat</span><span class="p">,</span> <span class="n">Cabbage</span> <span class="n">cabbage</span><span class="p">,</span> <span class="n">Wolf</span> <span class="n">wolf</span><span class="p">)</span>

<span class="cp">/** A record of where everything is. */</span>
<span class="k">class</span> <span class="n">State</span> <span class="k">extends</span> <span class="n">TState</span> <span class="p">{</span>
  <span class="n">Man</span> <span class="n">man</span><span class="p">;</span>
  <span class="n">Goat</span> <span class="n">goat</span><span class="p">;</span>
  <span class="n">Cabbage</span> <span class="n">cabbage</span><span class="p">;</span>
  <span class="n">Wolf</span> <span class="n">wolf</span><span class="p">;</span>

  <span class="n">State</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span> <span class="o">=</span> <span class="n">Currently</span><span class="p">(</span><span class="n">man</span><span class="p">,</span> <span class="n">goat</span><span class="p">,</span> <span class="n">cabbage</span><span class="p">,</span> <span class="n">wolf</span><span class="p">)</span> <span class="p">}</span>

  <span class="cp">/**</span>
<span class="cp">   * Returns the possible states that you can transition to</span>
<span class="cp">   * by ferrying one or zero cargo items.</span>
<span class="cp">   */</span>
  <span class="n">State</span> <span class="n">transition</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">result</span> <span class="o">=</span> <span class="n">Currently</span><span class="p">(</span><span class="n">man</span><span class="p">.</span><span class="n">cross</span><span class="p">(),</span> <span class="n">man</span><span class="p">.</span><span class="n">ferry</span><span class="p">(</span><span class="n">goat</span><span class="p">),</span> <span class="n">cabbage</span><span class="p">,</span> <span class="n">wolf</span><span class="p">)</span> <span class="k">or</span>
    <span class="k">result</span> <span class="o">=</span> <span class="n">Currently</span><span class="p">(</span><span class="n">man</span><span class="p">.</span><span class="n">cross</span><span class="p">(),</span> <span class="n">goat</span><span class="p">,</span> <span class="n">man</span><span class="p">.</span><span class="n">ferry</span><span class="p">(</span><span class="n">cabbage</span><span class="p">),</span> <span class="n">wolf</span><span class="p">)</span> <span class="k">or</span>
    <span class="k">result</span> <span class="o">=</span> <span class="n">Currently</span><span class="p">(</span><span class="n">man</span><span class="p">.</span><span class="n">cross</span><span class="p">(),</span> <span class="n">goat</span><span class="p">,</span> <span class="n">cabbage</span><span class="p">,</span> <span class="n">man</span><span class="p">.</span><span class="n">ferry</span><span class="p">(</span><span class="n">wolf</span><span class="p">))</span> <span class="k">or</span>
    <span class="k">result</span> <span class="o">=</span> <span class="n">Currently</span><span class="p">(</span><span class="n">man</span><span class="p">.</span><span class="n">cross</span><span class="p">(),</span> <span class="n">goat</span><span class="p">,</span> <span class="n">cabbage</span><span class="p">,</span> <span class="n">wolf</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="cp">/**</span>
<span class="cp">   * Returns all states that are reachable via a transition</span>
<span class="cp">   * and have not yet been visited.</span>
<span class="cp">   * `path` keeps track of how it is achieved.</span>
<span class="cp">   */</span>
  <span class="n">State</span> <span class="n">reachesVia</span><span class="p">(</span><span class="kt">string</span> <span class="n">path</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">exists</span><span class="p">(</span><span class="kt">string</span> <span class="n">pathSoFar</span> <span class="o">|</span>
      <span class="k">result</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="n">reachesVia</span><span class="p">(</span><span class="n">pathSoFar</span><span class="p">).</span><span class="n">transition</span><span class="p">()</span> <span class="k">and</span>
      <span class="k">not</span> <span class="k">exists</span><span class="p">(</span><span class="n">pathSoFar</span><span class="p">.</span><span class="n">indexOf</span><span class="p">(</span><span class="k">result</span><span class="p">.</span><span class="n">toString</span><span class="p">()))</span> <span class="k">and</span>
      <span class="n">path</span> <span class="o">=</span> <span class="n">pathSoFar</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span> <span class="o">+</span> <span class="k">result</span>
    <span class="p">)</span>
  <span class="p">}</span>

  <span class="kt">string</span> <span class="n">toString</span><span class="p">()</span> <span class="p">{</span> <span class="k">result</span> <span class="o">=</span> <span class="n">man</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">goat</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">cabbage</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">wolf</span> <span class="p">}</span>
<span class="p">}</span>

<span class="cp">/** The initial state, where everything is on the left shore. */</span>
<span class="k">class</span> <span class="n">InitialState</span> <span class="k">extends</span> <span class="n">State</span> <span class="p">{</span>
  <span class="n">InitialState</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">man</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">Left</span><span class="p">())</span> <span class="k">and</span> <span class="n">goat</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">Left</span><span class="p">())</span> <span class="k">and</span> <span class="n">cabbage</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">Left</span><span class="p">())</span> <span class="k">and</span> <span class="n">wolf</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">Left</span><span class="p">())</span>
  <span class="p">}</span>

  <span class="kr">override </span><span class="n">State</span> <span class="n">reachesVia</span><span class="p">(</span><span class="kt">string</span> <span class="n">path</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">path</span> <span class="o">=</span> <span class="k">this</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span> <span class="o">+</span> <span class="k">result</span> <span class="k">and</span> <span class="k">result</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="n">transition</span><span class="p">()</span>
    <span class="k">or</span>
    <span class="k">result</span> <span class="o">=</span> <span class="k">super</span><span class="p">.</span><span class="n">reachesVia</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="kr">override </span><span class="kt">string</span> <span class="n">toString</span><span class="p">()</span> <span class="p">{</span> <span class="k">result</span> <span class="o">=</span> <span class="s">&quot;Initial: &quot;</span> <span class="o">+</span> <span class="k">super</span><span class="p">.</span><span class="n">toString</span><span class="p">()</span> <span class="p">}</span>
<span class="p">}</span>

<span class="cp">/** The goal state, where everything is on the right shore. */</span>
<span class="k">class</span> <span class="n">GoalState</span> <span class="k">extends</span> <span class="n">State</span> <span class="p">{</span>
  <span class="n">GoalState</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">man</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">Right</span><span class="p">())</span> <span class="k">and</span> <span class="n">goat</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">Right</span><span class="p">())</span> <span class="k">and</span> <span class="n">cabbage</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">Right</span><span class="p">())</span> <span class="k">and</span> <span class="n">wolf</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">Right</span><span class="p">())</span>
  <span class="p">}</span>

  <span class="kr">override </span><span class="n">State</span> <span class="n">transition</span><span class="p">()</span> <span class="p">{</span> <span class="k">none</span><span class="p">()</span> <span class="p">}</span>

  <span class="kr">override </span><span class="kt">string</span> <span class="n">toString</span><span class="p">()</span> <span class="p">{</span> <span class="k">result</span> <span class="o">=</span> <span class="s">&quot;Goal: &quot;</span> <span class="o">+</span> <span class="k">super</span><span class="p">.</span><span class="n">toString</span><span class="p">()</span> <span class="p">}</span>
<span class="p">}</span>

<span class="cp">/** An unsafe state, where something gets eaten. */</span>
<span class="k">class</span> <span class="n">IllegalState</span> <span class="k">extends</span> <span class="n">State</span> <span class="p">{</span>
  <span class="n">IllegalState</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">exists</span><span class="p">(</span><span class="n">Shore</span> <span class="n">s</span> <span class="o">|</span>
      <span class="n">goat</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">and</span> <span class="n">cabbage</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">and</span> <span class="k">not</span> <span class="n">man</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
      <span class="k">or</span>
      <span class="n">wolf</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">and</span> <span class="n">goat</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">and</span> <span class="k">not</span> <span class="n">man</span><span class="p">.</span><span class="n">isOn</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="p">}</span>

  <span class="kr">override </span><span class="n">State</span> <span class="n">transition</span><span class="p">()</span> <span class="p">{</span> <span class="k">none</span><span class="p">()</span> <span class="p">}</span>

  <span class="kr">override </span><span class="kt">string</span> <span class="n">toString</span><span class="p">()</span> <span class="p">{</span> <span class="k">result</span> <span class="o">=</span> <span class="s">&quot;ILLEGAL: &quot;</span> <span class="o">+</span> <span class="k">super</span><span class="p">.</span><span class="n">toString</span><span class="p">()</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">from</span> <span class="kt">string</span> <span class="n">path</span>
<span class="k">where</span> <span class="k">any</span><span class="p">(</span><span class="n">InitialState</span> <span class="n">i</span><span class="p">).</span><span class="n">reachesVia</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">=</span> <span class="k">any</span><span class="p">(</span><span class="n">GoalState</span> <span class="n">g</span><span class="p">)</span>
<span class="k">select</span> <span class="n">path</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="further-reading">
<h2>Further reading<a class="headerlink" href="#further-reading" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>“<a class="reference internal" href="../ql-language-reference/index.html#ql-language-reference"><span class="std std-ref">QL language reference</span></a>”</li>
<li>“<a class="reference internal" href="../codeql-overview/codeql-tools.html#codeql-tools"><span class="std std-ref">CodeQL tools</span></a>”</li>
</ul>
</div>
</div>


    </article>

    <!-- GitHub footer, with links to terms and privacy statement -->
    <div class="px-3 px-md-6 f6 py-4 d-sm-flex flex-justify-between flex-row-reverse flex-items-center border-top">
        <ul class="list-style-none d-flex flex-items-center mb-3 mb-sm-0 lh-condensed-ultra">
            <li class="mr-3">
                <a href="https://twitter.com/github" title="GitHub on Twitter" style="color: #959da5;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 273.5 222.3" class="d-block" height="18">
                        <path
                            d="M273.5 26.3a109.77 109.77 0 0 1-32.2 8.8 56.07 56.07 0 0 0 24.7-31 113.39 113.39 0 0 1-35.7 13.6 56.1 56.1 0 0 0-97 38.4 54 54 0 0 0 1.5 12.8A159.68 159.68 0 0 1 19.1 10.3a56.12 56.12 0 0 0 17.4 74.9 56.06 56.06 0 0 1-25.4-7v.7a56.11 56.11 0 0 0 45 55 55.65 55.65 0 0 1-14.8 2 62.39 62.39 0 0 1-10.6-1 56.24 56.24 0 0 0 52.4 39 112.87 112.87 0 0 1-69.7 24 119 119 0 0 1-13.4-.8 158.83 158.83 0 0 0 86 25.2c103.2 0 159.6-85.5 159.6-159.6 0-2.4-.1-4.9-.2-7.3a114.25 114.25 0 0 0 28.1-29.1"
                            fill="currentColor"></path>
                    </svg>
                </a>
            </li>
            <li class="mr-3">
                <a href="https://www.facebook.com/GitHub" title="GitHub on Facebook" style="color: #959da5;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.3 15.4" class="d-block" height="18">
                        <path
                            d="M14.5 0H.8a.88.88 0 0 0-.8.9v13.6a.88.88 0 0 0 .8.9h7.3v-6h-2V7.1h2V5.4a2.87 2.87 0 0 1 2.5-3.1h.5a10.87 10.87 0 0 1 1.8.1v2.1h-1.3c-1 0-1.1.5-1.1 1.1v1.5h2.3l-.3 2.3h-2v5.9h3.9a.88.88 0 0 0 .9-.8V.8a.86.86 0 0 0-.8-.8z"
                            fill="currentColor"></path>
                    </svg>
                </a>
            </li>
            <li class="mr-3">
                <a href="https://www.youtube.com/github" title="GitHub on YouTube" style="color: #959da5;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.17 13.6" class="d-block" height="16">
                        <path
                            d="M18.77 2.13A2.4 2.4 0 0 0 17.09.42C15.59 0 9.58 0 9.58 0a57.55 57.55 0 0 0-7.5.4A2.49 2.49 0 0 0 .39 2.13 26.27 26.27 0 0 0 0 6.8a26.15 26.15 0 0 0 .39 4.67 2.43 2.43 0 0 0 1.69 1.71c1.52.42 7.5.42 7.5.42a57.69 57.69 0 0 0 7.51-.4 2.4 2.4 0 0 0 1.68-1.71 25.63 25.63 0 0 0 .4-4.67 24 24 0 0 0-.4-4.69zM7.67 9.71V3.89l5 2.91z"
                            fill="currentColor"></path>
                    </svg>
                </a>
            </li>
            <li class="mr-3 flex-self-start">
                <a href="https://www.linkedin.com/company/github" title="GitHub on Linkedin" style="color: #959da5;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19 18" class="d-block" height="18">
                        <path
                            d="M3.94 2A2 2 0 1 1 2 0a2 2 0 0 1 1.94 2zM4 5.48H0V18h4zm6.32 0H6.34V18h3.94v-6.57c0-3.66 4.77-4 4.77 0V18H19v-7.93c0-6.17-7.06-5.94-8.72-2.91z"
                            fill="currentColor"></path>
                    </svg>
                </a>
            </li>
            <li>
                <a href="https://github.com/github" title="GitHub's organization" style="color: #959da5;">
                    <svg version="1.1" width="20" height="20" viewBox="0 0 16 16" class="octicon octicon-mark-github"
                        aria-hidden="true">
                        <path fill-rule="evenodd"
                            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
                        </path>
                    </svg>
                </a>
            </li>
        </ul>
        <ul class="list-style-none d-flex text-gray">
            <li class="mr-3">&copy; 
                <script type="text/javascript">document.write(new Date().getFullYear());</script> GitHub, Inc.</li>
            <li class="mr-3"><a
                    href="https://docs.github.com/github/site-policy/github-terms-of-service"
                    class="link-gray">Terms </a></li>
            <li><a href="https://docs.github.com/github/site-policy/github-privacy-statement"
                    class="link-gray">Privacy </a></li>
        </ul>
    </div>
</div>
</main>

<script type="text/javascript">
    $(document).ready(function () {
        $(".toggle > *").hide();
        $(".toggle .name").show();
        $(".toggle .name").click(function () {
            $(this).parent().children().not(".name").toggle(400);
            $(this).parent().children(".name").toggleClass("open");
        })
    });
</script>

  </body>
</html>