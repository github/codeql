name: Fetch CodeQL
description: Fetches the latest version of CodeQL
runs:
  using: composite
  steps:
    - name: Select platform - Linux
      if: runner.os == 'Linux'
      run: |
        export CODEQL_CLI_PLATFORM=linux64
        echo "::set-env name=CODEQL_CLI_PLATFORM::$CODEQL_CLI_PLATFORM"

    - name: Select platform - MacOS
      if: runner.os == 'MacOS'
      run: |
        export CODEQL_CLI_PLATFORM=osx64
        echo "::set-env name=CODEQL_CLI_PLATFORM::$CODEQL_CLI_PLATFORM"

    - name: Fetch CodeQL
      shell: bash
      run: |
        LATEST=$(gh release list --repo https://github.com/github/codeql-cli-binaries | cut -f 1 | grep -v beta | sort --version-sort | tail -1)
        gh release download --repo https://github.com/github/codeql-cli-binaries --pattern codeql-$CODEQL_CLI_PLATFORM.zip "$LATEST"
        unzip -q -d "${RUNNER_TEMP}" codeql-$CODEQL_CLI_PLATFORM.zip
        echo "${RUNNER_TEMP}/codeql" >> "${GITHUB_PATH}"
      env:
        GITHUB_TOKEN: ${{ github.token }}
