/**
 * @name Binding a socket to all network interfaces
 * @description Binding a socket to all interfaces would open up traffic from any IPv4 address
   and is therefore associated with security risks.
 * @kind problem
 * @tags severity
 *       warning
 *         security
 * @problem.severity error
 * @sub-severity low
 * @precision high
 * @id py/bind-socket-all-network-interfaces
 */

import python

ModuleObject socketModule() { result = ModuleObject::named("socket") }

ClassObject socketClass() { result = socketModule().attr("socket") }

string allInterfaces() { result = "0.0.0.0" or result = "" }

from CallNode call, string address
where
  call = socketClass().lookupAttribute("bind").(FunctionObject).getACall() and
  address = call.getArg(0).getNode().(Tuple).getElt(0).(StrConst).getText() and
  address = allInterfaces()
select call.getNode(), "'" + address + "' binds a socket to all interfaces."
