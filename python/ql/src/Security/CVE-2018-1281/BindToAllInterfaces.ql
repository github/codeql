/**
 * @name Binding a socket to all network interfaces
 * @description Binding a socket to all interfaces would open up traffic from any IPv4 address
 * and is therefore associated with security risks.
 * @kind problem
 * @tags severity
 *       warning
 *       security
 * @problem.severity error
 * @sub-severity low
 * @precision high
 * @id py/bind-socket-all-network-interfaces
 */

import python

Value aSocket() { result.getClass() = Value::named("socket.socket") }

CallNode socketBindCall() {
  result = aSocket().attr("bind").(CallableValue).getACall() and major_version() = 3
  or
  result.getFunction().(AttrNode).getObject("bind").pointsTo(aSocket()) and
  major_version() = 2
}

string allInterfaces() { result = "0.0.0.0" or result = "" }

from CallNode call, string address
where
  call = socketBindCall() and
  address = call.getArg(0).getNode().(Tuple).getElt(0).(StrConst).getText() and
  address = allInterfaces()
select call.getNode(), "'" + address + "' binds a socket to all interfaces."
